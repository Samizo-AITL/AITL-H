# 第9章：SoC統合と協調設計（ハード＋ソフト＋AITL連携）

## 🎯 本章の目的

AITL構造を備えたPoCをSoC（System on Chip）として統合する際の設計戦略と、  
ハードウェア・ソフトウェア・AI推論層（LLM）との連携方法について記述します。

---

## 🧩 AITL構造のSoCマッピング

| 層         | 実装対象                  | 説明                                |
|------------|---------------------------|-------------------------------------|
| 知性層     | LLMモジュール（外部/内部） | 状況判断と修復命令、対話戦略           |
| 理性層     | PIDブロック（ハード/ソフト） | アナログ量制御、ゲイン補償             |
| 本能層     | FSMコントローラ（HDL）      | 状態遷移制御、基本行動指令              |

→ これらをRISC-Vまたは制御用MCU上で協調動作させる。

---

## 🔁 ソフト＋ハード連携構造（ブロック例）

```text
+--------------------+
|  LLM Module (Python/API)  |
+--------------------+
          |
          v
+--------------------+      +------------------+
|  RISC-V Core       | ---> |  FSM Controller  |
+--------------------+      +------------------+
          |                          |
          v                          v
    PID Controller         Actuator / Sensor I/F
```

## ⚙️ HDL構成と統合イメージ

| モジュール名        | 説明                                 |
|---------------------|--------------------------------------|
| `fsm_engine.v`      | 状態遷移処理ロジックを記述したFSMブロック       |
| `pid_core.v`        | アナログ制御用PID計算ブロック                 |
| `uart_comm.v`       | LLMや外部制御装置からのコマンド受信用UART通信 |
| `sensor_mux.v`      | 複数センサ入力を選択しFSM/PIDへ供給するマルチプレクサ |
| `top_soc.v`         | 各ブロックを接続しSoC全体として統合するトップ層モジュール |

→ PoCではVerilog HDLで記述し、Simulation + Synthesisまで対応可能。

---

## 🛠 ソフト設計との連携項目

- FSMの各状態と対応する動作命令の定義表（例：`fsm_state_def.yaml`）
- PIDゲインの初期値／リアルタイム書換に対応した `pid_api.c`
- UART出力仕様のドキュメント化（例：JSONまたはタグ付きログ形式）

---

## 🧪 統合後の検証と評価指標

| 評価項目             | 検証方法例                                      |
|----------------------|-------------------------------------------------|
| 制御応答性           | 状態遷移～アクチュエータ応答までの遅延を測定         |
| LLM命令伝達遅延      | UART経由での命令発行→FSM遷移までのクロック数計測     |
| 統合安定性           | 各モジュールに擬似異常を注入し、復旧動作を観察        |
| システムリソース利用率 | LUT数／フリップフロップ数／最大動作周波数などを合成結果から評価 |

---

## 📁 推奨ディレクトリ構成（SoC統合用）

```text
soc_integration/
├── rtl/
│   ├── fsm_engine.v
│   ├── pid_core.v
│   ├── uart_comm.v
│   ├── sensor_mux.v
│   └── top_soc.v
├── sw/
│   ├── main_control.c
│   ├── llm_if.c
│   └── pid_api.c
└── testbench/
    └── soc_tb.v
```

---

## 📬 連絡先

執筆・設計：三溝 真一（Shinichi Samizo）
GitHub: https://github.com/Samizo-AITL
Email: shin3t72@gmail.com
