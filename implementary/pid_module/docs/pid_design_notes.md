# 📘 PID制御設計ノート – 実装とパラメータ調整の勘所

このドキュメントでは、AITL-Hにおける物理層制御の中核である**PID制御**の実装設計とパラメータ調整の実践ノウハウを整理します。

---

## 🎯 1. 基本構成と制御式

PID制御器は以下の制御式で構成されます：

\[
u(t) = K_p \cdot e(t) + K_i \int e(t)dt + K_d \cdot \frac{de(t)}{dt}
\]

| 成分 | 役割 |
|------|------|
| \( K_p \) | 偏差への即応性 |
| \( K_i \) | 定常誤差の解消 |
| \( K_d \) | 変化に対する先読み抑制 |

---

## 🔧 2. 実装ポイント

- **サンプリング周期（dt）**を一定に保つ（例：0.01s）
- **誤差積分の発散防止**（積分飽和対策）
- **微分ノイズ対策**（低パスフィルタ or 差分制限）

```python
# 擬似コード例
error = target - measured
integral += error * dt
derivative = (error - previous_error) / dt
output = Kp * error + Ki * integral + Kd * derivative
```

## 🧪 3. パラメータ調整法

### 📌 Ziegler–Nichols法（古典的）

1. Ki, Kd = 0 として Kp を徐々に上げ、定常振動を確認
2. その振動周波数・ゲインから以下に従って算出：

| タイプ | Kp      | Ki               | Kd             |
|--------|----------|------------------|----------------|
| P      | 0.5Ku    | –                | –              |
| PI     | 0.45Ku   | 1.2Kp / Tu       | –              |
| PID    | 0.6Ku    | 2Kp / Tu         | Kp * Tu / 8    |

※Ku：最小限の定常振動を生むKp  
※Tu：そのときの振動周期

---

### 📌 手動調整の指針

| 状態 | 対応方法（調整パラメータ） |
|------|-----------------------------|
| 応答が遅い        | Kp を上げる                 |
| オーバーシュート大 | Kd を上げる                 |
| 定常誤差が残る    | Ki を上げる                 |
| 振動が発生する    | Kp や Ki を下げ、Kd を上げる |

---

## 📈 4. 応答評価指標

| 指標 | 説明 |
|------|------|
| 上昇時間（Tr） | 10%→90%達成までの時間 |
| オーバーシュート（Mp） | 初期目標値超過の最大率 |
| 定常誤差（Ess） | 最終目標との差 |
| セトリング時間（Ts） | ±2%範囲内に収束するまでの時間 |

これらの指標は、PIDパラメータ調整の際の評価基準として用います。

---

## 📂 推奨ファイル構成

- `pid_controller.py`：基本PID制御クラス
- `test_pid_step.ipynb`：ステップ応答評価ノートブック
- `gain_tuner.py`：ゲイン調整用スクリプト
- `plot_response.py`：時系列プロット自動生成

---

## 🚧 注意点

- PIDは**遅延系**や**非線形系**には不向き → モデル化が必要
- モータ制御では**デッドバンド（無反応帯）**を考慮
- PWM出力との接続時に**量子化誤差**が顕著になるケースあり
- Ki（積分）項が大きすぎると**積分飽和**により逆に不安定化する

---

## ✍️ 制作者より

PID制御は非常にシンプルながら、正確なチューニングがなされて初めて本来の性能を発揮します。  
AITL-Hの物理層では、このPIDが**最終的な出力品質**を保証する存在です。  
各制御系で安定かつ応答性の高い動作を目指す上で、**パラメータ調整とシミュレーション検証は不可欠**です。

---
