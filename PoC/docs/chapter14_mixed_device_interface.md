# 第14章：外付け・混載デバイスとのインタフェース設計

## 🎯 本章の目的

PoCから製品化を視野に入れた際、他デバイス（センサ、アクチュエータ、通信モジュールなど）との信号・電源・論理レベル整合が重要になります。本章では、混載デバイスとのインタフェース設計で注意すべき観点を整理します。

---

## 🔌 インタフェースの種類と特性

| 接続タイプ       | 代表例                         | 注意点（PoC設計での留意）              |
|------------------|----------------------------------|----------------------------------------|
| デジタルI/F      | UART, SPI, I²C                   | 電圧レベル整合、プルアップ抵抗        |
| アナログI/F      | 温度センサ、電流センサ           | フィルタ設計、ADC入力域との調整        |
| 電源インタフェース | サーボモータ、照明制御            | 突入電流抑制、電源ノイズの隔離         |
| 複合通信         | BLE/Wi-Fi/Ethernet               | 電源共有時のノイズ混入、クロック同期   |

---

## 🧩 AITL構造と外部デバイスの対応

| AITL層       | 典型的な外部接続先例         | 接続設計での要点              |
|--------------|-------------------------------|-------------------------------|
| FSM（本能）  | GPIO制御ピン、サーボPWM        | 信号遅延に対するタイミング冗長設計 |
| PID（理性）  | モータドライバ、ADC, DAC       | 出力応答に対するスルーレート最適化 |
| LLM（知性）  | 外部API通信、センサ情報の中継   | JSONパースやプロトコル整合       |

---

## 🛠 混載デバイスの物理配置とレイアウト指針

- アナログ・デジタルの領域分離（クロストーク回避）
- GNDプレーン分離と一点接地
- インタフェースごとのデカップリング推奨
- 配線はなるべく短く・等長・パラレル避ける

---

## 📄 接続図テンプレート例

```text
mixed_device_interface/
├── pin_assignment_table.xlsx     # ピン配置と機能定義
├── level_shift_map.md            # 電圧レベル変換マトリクス
├── adc_interface_notes.md        # アナログ信号接続設計メモ
└── interface_block_diagram.svg   # 外部接続のブロック図
```

---

## 🔧 トラブル事例と対応策

| 現象                         | 原因例                        | 対策                             |
|------------------------------|-------------------------------|----------------------------------|
| センサ誤動作（PWM重畳）       | PWM波形によるADC干渉           | 配線分離＋ローパスフィルタ挿入     |
| UART通信エラー（受信不良）     | GND電位差／プルアップ不足      | 共通GND化／外部プルアップ設計追加 |
| DAC出力の非直線性             | 出力負荷オーバー              | バッファアンプ追加、R負荷制限     |

---

## 📬 連絡先

執筆・設計：**三溝 真一（Shinichi Samizo）**  
GitHub: [https://github.com/Samizo-AITL](https://github.com/Samizo-AITL)  
Email: shin3t72@gmail.com

---
