---
layout: default
title: FSMçŠ¶æ…‹é·ç§»è¡¨ï¼ˆPoCè¨­è¨ˆä»•æ§˜ï¼‰
nav_order: 1
description: AITL-H ä¸‰å±¤åˆ¶å¾¡æ§‹é€ ï¼ˆFSMâ€“PIDâ€“LLMï¼‰ã®ã†ã¡ã€FSMï¼ˆè¡Œå‹•åˆ¶å¾¡ï¼‰ã®PoCè¨­è¨ˆä»•æ§˜ã€‚
permalink: /AITL-H/fsm_state_table/
---

---

# ğŸ§  FSMçŠ¶æ…‹é·ç§»è¡¨ï¼ˆPoCè¨­è¨ˆä»•æ§˜ï¼‰

AITL-Hãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ãŠã‘ã‚‹ã€Œä¸‰å±¤åˆ¶å¾¡æ§‹é€ ï¼ˆFSMâ€“PIDâ€“LLMï¼‰ã€ã®ã†ã¡ã€FSMï¼ˆè¡Œå‹•åˆ¶å¾¡ï¼‰ã®è¨­è¨ˆä»•æ§˜ã§ã™ã€‚  
æœ¬çŠ¶æ…‹é·ç§»è¡¨ã¯ã€FSMã‚’**è¨­è¨ˆèµ·ç‚¹**ã¨ã—ã¦å®šç¾©ã—ã€PIDåˆ¶å¾¡ãƒ»PWMå‡ºåŠ›ãƒ»UART/ã‚»ãƒ³ã‚µå…¥åŠ›ã¨ã®**æ§‹é€ çš„ãªæ¥ç¶š**ã‚’è¡Œã†ãŸã‚ã®åŸºç¤è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã™ã€‚

---

## ğŸ¯ åˆ¶å¾¡å¯¾è±¡ã®æ¦‚è¦

| é …ç›®         | å†…å®¹                                                         |
|--------------|--------------------------------------------------------------|
| åˆ¶å¾¡å¯¾è±¡     | äººå‹ãƒ­ãƒœãƒƒãƒˆã®åŸºæœ¬è¡Œå‹•ï¼ˆå¾…æ©Ÿãƒ»å‰é€²ãƒ»åœæ­¢ãƒ»æ–¹å‘è»¢æ›ï¼‰       |
| å…¥åŠ›ã‚¤ãƒ™ãƒ³ãƒˆ | UARTå‘½ä»¤ï¼ˆLLMçµŒç”±ï¼‰ã€ã‚»ãƒ³ã‚µä¿¡å·ï¼ˆè·é›¢ã‚»ãƒ³ã‚µã€è§’åº¦ã‚»ãƒ³ã‚µï¼‰ |
| å‡ºåŠ›ä¿¡å·     | PWMåˆ¶å¾¡ã€PIDç›®æ¨™å€¤ã€UARTå¿œç­”ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸                      |
| å®Ÿè£…å¯¾è±¡     | Python (`fsm_engine.py`)ã€å°†æ¥ã¯Verilogã¸ã®å±•é–‹ã‚’æƒ³å®š      |

---

## ğŸ—‚ çŠ¶æ…‹ä¸€è¦§ï¼ˆState Definitionsï¼‰

| çŠ¶æ…‹å     | èª¬æ˜                        |
|------------|-----------------------------|
| `IDLE`     | åˆæœŸå¾…æ©ŸçŠ¶æ…‹ã€ã‚»ãƒ³ã‚µç›£è¦–ä¸­ |
| `WALK`     | å‰é€²ç§»å‹•åˆ¶å¾¡ä¸­              |
| `TURN`     | æ–¹å‘è»¢æ›åˆ¶å¾¡ä¸­              |
| `STOP`     | å¼·åˆ¶åœæ­¢çŠ¶æ…‹                |
| `LLM_WAIT` | LLMå‘½ä»¤å¾…ã¡ã®å—ä»˜çŠ¶æ…‹       |

---

## ğŸ” çŠ¶æ…‹é·ç§»ãƒ«ãƒ¼ãƒ«ï¼ˆState Transitionsï¼‰

| ç¾åœ¨ã®çŠ¶æ…‹ | ã‚¤ãƒ™ãƒ³ãƒˆ                   | æ¬¡ã®çŠ¶æ…‹ | æ¡ä»¶ä¾‹                  |
|------------|----------------------------|----------|-------------------------|
| `IDLE`     | UARTã§ "walk"              | `WALK`   | `uart_cmd == "walk"`    |
| `IDLE`     | UARTã§ "wait_llm"          | `LLM_WAIT`| `uart_cmd == "wait_llm"`|
| `WALK`     | UARTã§ "stop"              | `STOP`   | `uart_cmd == "stop"`    |
| `WALK`     | è·é›¢ã‚»ãƒ³ã‚µå€¤ãŒé–¾å€¤è¶…é     | `STOP`   | `distance > 100`        |
| `STOP`     | UARTã§ "turn"              | `TURN`   | `uart_cmd == "turn"`    |
| `TURN`     | å›è»¢å®Œäº†ï¼ˆè§’åº¦èª¤å·®ãŒ0ï¼‰     | `IDLE`   | `angle_error < 1`       |
| `LLM_WAIT` | LLMã‹ã‚‰æ–°ã—ã„æŒ‡ç¤ºå—ä¿¡       | `IDLE`   | `uart_ready == True`    |

---

## ğŸ§¾ å„çŠ¶æ…‹ã®å‡ºåŠ›åˆ¶å¾¡ä¿¡å·ï¼ˆOutput Mappingï¼‰

| çŠ¶æ…‹å     | PWMå‡ºåŠ› | PIDç›®æ¨™å€¤     | UARTå¿œç­”           |
|------------|----------|----------------|----------------------|
| `IDLE`     | OFF      | None           | "Waiting for command"|
| `WALK`     | ON       | speed = 5.0    | "Walking forward"    |
| `TURN`     | ON       | angle = 90.0   | "Turning right"      |
| `STOP`     | OFF      | None           | "Stopped"            |
| `LLM_WAIT` | OFF      | None           | "Awaiting instruction"|

---

## ğŸ”— æ¥ç¶šå…ˆãƒ–ãƒ­ãƒƒã‚¯ã¨ã®é–¢ä¿‚

- å„çŠ¶æ…‹ã®å‡ºåŠ›ã¯ `pid_controller.py`, `pwm_driver.py`, `uart_driver.py` ã«ä¿¡å·ã‚’é€ã‚‹ã€‚
- æœ¬çŠ¶æ…‹é·ç§»è¡¨ã«å¯¾å¿œã™ã‚‹ä¿¡å·ä»•æ§˜ã¯ [`interface_spec.md`](./interface_spec.md) ã«è¨˜è¿°äºˆå®šã€‚
- FSMçŠ¶æ…‹ã¯ `fsm_engine.py` ã«ã¦ã‚¯ãƒ©ã‚¹ã¾ãŸã¯çŠ¶æ…‹è¾æ›¸ã«ã‚ˆã‚Šå®Ÿè£…äºˆå®šã€‚

---

## ğŸ“ å‚™è€ƒ

- çŠ¶æ…‹åãƒ»å‡ºåŠ›ä¿¡å·ãƒ»ã‚¤ãƒ™ãƒ³ãƒˆåã¯ã€RTLåŒ–ã‚’æ„è­˜ã—ã¦ãƒ—ãƒ¬ãƒ•ã‚£ã‚¯ã‚¹ã‚„å‘½åè¦å‰‡ã‚’å¾Œè¿°ã™ã‚‹ã€‚
- ä»Šå¾Œã€çŠ¶æ…‹é·ç§»ã«ã‚¿ã‚¤ãƒãƒˆãƒªã‚¬ã‚„ã‚»ãƒ³ã‚µé€£æºã‚’è¿½åŠ å¯èƒ½ã€‚
- FSMã¯PoCã«ãŠã„ã¦**åˆ¶å¾¡è¨­è¨ˆã®èµ·ç‚¹**ã§ã‚ã‚Šã€ã™ã¹ã¦ã®ä¸‹ä½åˆ¶å¾¡ãŒã“ã®å®šç¾©ã«å¾“ã†ã€‚
