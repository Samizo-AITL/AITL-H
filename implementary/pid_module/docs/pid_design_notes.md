# 📘 PID制御設計ノート – 実装とパラメータ調整の勘所

このドキュメントでは、AITL-Hにおける物理層制御の中核である**PID制御**の実装設計とパラメータ調整の実践ノウハウを整理します。

---

## 🎯 1. 基本構成と制御式

PID制御器は以下の制御式で構成されます：

\[
u(t) = K_p \cdot e(t) + K_i \int e(t)dt + K_d \cdot \frac{de(t)}{dt}
\]

| 成分 | 役割 |
|------|------|
| \( K_p \) | 偏差への即応性 |
| \( K_i \) | 定常誤差の解消 |
| \( K_d \) | 変化に対する先読み抑制 |

---

## 🔧 2. 実装ポイント

- **サンプリング周期（dt）**を一定に保つ（例：0.01s）
- **誤差積分の発散防止**（積分飽和対策）
- **微分ノイズ対策**（低パスフィルタ or 差分制限）

```python
# 擬似コード例
error = target - measured
integral += error * dt
derivative = (error - previous_error) / dt
output = Kp * error + Ki * integral + Kd * derivative
```

## 🧪 3. パラメータ調整法

### 📌 Ziegler–Nichols法（古典的）

1. Ki, Kd = 0 として Kp を徐々に上げ、定常振動を確認
2. その振動周波数・ゲインから以下に従って算出：

| タイプ | Kp      | Ki               | Kd             |
|--------|----------|------------------|----------------|
| P      | 0.5Ku    | –                | –              |
| PI     | 0.45Ku   | 1.2Kp / Tu       | –              |
| PID    | 0.6Ku    | 2Kp / Tu         | Kp * Tu / 8    |

※Ku：最小限の定常振動を生むKp  
※Tu：そのときの振動周期

---

### 📌 手動調整の指針

| 状態 | 対応方法（調整パラメータ） |
|------|-----------------------------|
| 応答が遅い        | Kp を上げる                 |
| オーバーシュート大 | Kd を上げる                 |
| 定常誤差が残る    | Ki を上げる                 |
| 振動が発生する    | Kp や Ki を下げ、Kd を上げる |

---

## 📈 4. 応答評価指標

| 指標 | 説明 |
|------|------|
| 上昇時間（Tr） | 10%→90%達成までの時間 |
| オーバーシュート（Mp） | 初期目標値超過の最大率 |
| 定常誤差（Ess） | 最終目標との差 |
| セトリング時間（Ts） | ±2%範囲内に収束するまでの時間 |

これらの指標は、PIDパラメータ調整の際の評価基準として用います。

---

## 🚀 5. H∞制御とロバスト設計

PID制御では外乱やモデル誤差に対して十分な対策が難しい場合があります。  
AITL-Hでは、**H∞（H-infinity）制御**を補助的に導入し、**ロバスト性**と**安定性保証**を強化します。

---

### 📘 H∞制御の概要

- **目的**：外乱入力wに対する出力zの影響を最小化（∞ノルムで最小化）
- **状態空間表現**：  
\[
\begin{cases}
\dot{x} = Ax + Bu + Ew \\
z = Cx + Du
\end{cases}
\]
- 解法：リカッチ方程式による最適ゲイン計算（LMIなど）

---

### 💡 比較：PID vs H∞

| 観点           | PID制御                  | H∞制御                                  |
|----------------|---------------------------|------------------------------------------|
| 特徴           | シンプル・直感的           | 数理的・ロバスト性重視                   |
| 対応可能な外乱 | 制限的                    | 広範囲な外乱に対応                        |
| 実装難易度     | 低                        | 高（LTIモデル、数値解法が必要）          |
| AITLでの位置付け | 物理層の基本制御           | 物理層の**外乱対応用補助制御**            |

---

## 🧠 AITL-H における設計戦略

- 通常時はPIDを基本とした制御ループで稼働
- 外乱が大きい状況では、H∞制御ロジックを**上書き適用**
- LLM/FSMとの協調で「制御切り替え条件」を設計に組み込む

---

## 📂 実装補足ファイル

- `hinf_controller.py`：状態空間ベースのH∞制御器（簡易版）
- `plant_model.py`：制御対象のLTIモデル定義
- `hinf_vs_pid_sim.ipynb`：PIDとH∞の比較可視化ノートブック

---

## ✍️ 制作者より

PIDが人間的な「直感」であれば、H∞は「数理による守り」です。  
制御対象が変化したり、外乱が不確定であっても性能を保つ、というロバスト性を重視するならば、**H∞制御の理論と実装知識は有用**です。  
AITL-Hでは、こうした制御の「守備力」を持つことで、**対話的かつ状況適応的な知能制御の信頼性**を高めていきます。

---

